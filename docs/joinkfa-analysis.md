# joinkfa.com 페이지 구조 분석 결과

## 개요

KFA 통합경기정보시스템 (www.joinkfa.com)의 경기 결과 페이지 구조 및 크롤링 방법 분석

**분석 일자**: 2025-01-XX  
**분석 도구**: Playwright 브라우저 자동화

---

## 1. 페이지 접근 방법

### 기본 URL
- **메인 페이지**: `https://www.joinkfa.com/`
- **경기 결과 페이지**: `https://www.joinkfa.com/portal/mat/...` (구조 확인 필요)

### 대회 선택 방법
- [ ] URL 파라미터로 대회 선택
- [ ] 페이지 내 셀렉트 박스로 대회 선택
- [ ] API 호출 시 파라미터로 대회 전송
- [ ] 기타: ________________

---

## 2. Network API 분석

### 주요 API 엔드포인트

#### 2.1 getInitData1.do
- **URL**: `https://www.joinkfa.com/portal/mat/getInitData1.do`
- **Method**: POST
- **용도**: 초기 데이터 로드 (대회 목록, 기본 정보 등)
- **Request Body**: (확인 필요)
- **Response**: (확인 필요)

#### 2.2 getMatchList.do
- **URL**: `https://www.joinkfa.com/portal/mat/getMatchList.do`
- **Method**: POST
- **용도**: 경기 목록 조회
- **Request Body**: (확인 필요)
  - 예상 파라미터:
    - `mat_seq`: 대회 ID
    - `league_id`: 리그 ID
    - `age_group`: 연령대
    - 기타 필터 조건
- **Response**: (확인 필요)
  - 예상 구조:
    ```json
    {
      "matches": [
        {
          "homeTeam": "팀명",
          "awayTeam": "팀명",
          "homeScore": 2,
          "awayScore": 1,
          "date": "2025-01-XX",
          "time": "10:00"
        }
      ]
    }
    ```

#### 2.3 getPopup.do
- **URL**: `https://www.joinkfa.com/portal/mat/getPopup.do?CALL_TYPE=NEXACRO`
- **Method**: POST
- **용도**: 팝업 데이터 (선택사항)

---

## 3. 페이지 구조 분석

### 3.1 DOM 구조
- **테이블 기반**: 경기 결과가 테이블로 표시되는지 확인 필요
- **동적 로드**: JavaScript로 동적 로드되는지 확인 필요
- **SPA 구조**: URL이 변하지 않는 SPA 구조인지 확인 필요

### 3.2 대회 선택 UI
- **셀렉트 박스**: (확인 필요)
  - ID: `________________`
  - Name: `________________`
  - 옵션: `________________`
- **버튼**: (확인 필요)
  - 조회 버튼: `________________`
  - 검색 버튼: `________________`

### 3.3 폼 구조
- **폼 ID/Name**: (확인 필요)
- **입력 필드**: (확인 필요)
  - 대회 선택 필드: `________________`
  - 리그 선택 필드: `________________`
  - 연령대 선택 필드: `________________`

---

## 4. 크롤링 전략

### 4.1 현재 구현 방식
1. **Playwright 브라우저 자동화**
   - Chromium 브라우저 실행
   - 페이지 접속 및 JavaScript 실행 대기
   - Network 요청 가로채기 (API 응답 수집)
   - DOM 직접 추출 (백업)

2. **데이터 수집 방법**
   - 방법 1: API 응답 가로채기 (우선)
     - `getMatchList.do` 응답 수신
     - JSON 파싱하여 경기 결과 추출
   - 방법 2: DOM 직접 추출 (백업)
     - 테이블에서 경기 결과 파싱
     - 점수 패턴 매칭 (`\d+[:\-]\d+`)

3. **DB 매칭 및 업데이트**
   - 팀명 기반 유연한 매칭
   - 점수 업데이트
   - 상태를 "종료"로 변경

### 4.2 개선 필요 사항
- [ ] 대회 선택 자동화 로직 추가
- [ ] API 응답 구조에 맞는 파싱 로직 개선
- [ ] 에러 처리 강화
- [ ] 로그인 세션 처리 (필요 시)

---

## 5. 실제 분석 결과

> **참고**: 아래 섹션은 실제 페이지 구조 분석 도구를 사용한 결과를 입력하세요.

### 5.1 페이지 기본 정보
- **제목**: `________________`
- **최종 URL**: `________________`
- **URL 파라미터**: `________________`

### 5.2 셀렉트 박스
```
[분석 결과 입력]
```

### 5.3 버튼
```
[분석 결과 입력]
```

### 5.4 Network 요청
```
[분석 결과 입력]
```

### 5.5 폼 구조
```
[분석 결과 입력]
```

---

## 6. 크롤링 시나리오

### 시나리오 1: URL 파라미터로 대회 선택
```
1. 사용자가 대회별 URL을 직접 입력
2. Playwright로 해당 URL 접속
3. API 응답 가로채기
4. 경기 결과 추출 및 DB 업데이트
```

### 시나리오 2: 페이지 내 대회 선택
```
1. 기본 페이지 접속
2. 셀렉트 박스에서 대회 선택
3. 조회 버튼 클릭
4. API 응답 가로채기
5. 경기 결과 추출 및 DB 업데이트
```

### 시나리오 3: API 직접 호출
```
1. Network 탭에서 확인한 API 파라미터 사용
2. API 직접 호출 (세션 쿠키 필요할 수 있음)
3. 응답 데이터 파싱
4. 경기 결과 추출 및 DB 업데이트
```

---

## 7. 알려진 이슈 및 제약사항

1. **세션 쿠키 필요**
   - API 직접 호출 시 세션 쿠키가 필요할 수 있음
   - Playwright 사용 시 자동으로 처리됨

2. **동적 콘텐츠 로드**
   - JavaScript 실행 후 데이터가 로드됨
   - `waitForTimeout` 또는 `waitForSelector` 사용 필요

3. **페이지 구조 변경**
   - joinkfa.com 페이지 구조가 변경될 수 있음
   - 정기적인 확인 및 업데이트 필요

---

## 8. 다음 단계

1. [ ] 실제 페이지 구조 분석 실행
2. [ ] 대회 선택 방법 확인
3. [ ] API 응답 구조 확인
4. [ ] 파싱 로직 개선
5. [ ] 테스트 및 검증

---

## 9. 참고 자료

- Network 탭 분석 결과
- API 응답 샘플
- 페이지 스크린샷

---

**마지막 업데이트**: 2025-01-XX
